<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <title>CRUD Blog</title>
        <style>
            #alertDialog {
                margin-top:10%;
                padding-left:10%;
                padding-right:10%;
            }
            * {
                background-color: #357960;
                color: #e2e2ea;
                font-family:'Segoe UI', Tahoma, Verdana, sans-serif;
            }
            body {
                margin-top: 7%;
                margin-left: 7%;
            }
            dialog {
                background-color: #f5625d;
                border-color: #000000;
                border-radius: 5%;
            }
            dialog * {
                margin-left: 10%;
                margin-top: 1%;
                margin-bottom: 1%;
            }
            dialog button{
                margin: 10%;
            }
            input {
                background-color: #e2e2ea;
                color: #f5625d;
            }
            p {
                background-color: #f5625d;
            }
            button {
                background-color: #f5625d;
                border-color: #000000;
            }
            i {
                color: #f5625d;
            }
            .summ {
                width: 80%;
            }
        </style>
    </head>
    <body>
        <h1>Blog posts</h1>
        <ul id="blog">    
        </ul>
        <button>Add Blog</button>
        <dialog id="createDialog">
            <p>Title</p>
            <input type="text">
            <p>Date</p>
            <input type="date">
            <p>Summary</p>
            <input class="summ" type="text">
            <button>Cancel</button>
            <button>Save</button>
        </dialog>
        <dialog id="confirmDialog">
            <p>Delete?</p>
            <button>Cancel</button>
            <button>Confirm</button>
        </dialog>
        <dialog id="editDialog">
            <p>Title</p>
            <input type="text">
            <p>Date</p>
            <input type="date">
            <p>Summary</p>
            <input class="summ" type="text">
            <button>Cancel</button>
            <button>Save</button>
        </dialog>

        <script>
            const createButton = document.getElementsByTagName("button")[0];
            const cancelButton = document.getElementsByTagName("button")[1];
            const saveButton = document.getElementsByTagName("button")[2];
            const cancelButton2 = document.getElementsByTagName("button")[3];
            const confirmButton = document.getElementsByTagName("button")[4];
            const cancelButton3 = document.getElementsByTagName("button")[5];
            const saveButton2 = document.getElementsByTagName("button")[6];
            const createDialog = document.getElementById("createDialog");
            const editButton = document.getElementsByTagName("span")[0];
            const deleteButton = document.getElementsByTagName("span")[1];
            const confirmDialog = document.getElementById("confirmDialog");

            let blogs = JSON.parse(localStorage.getItem("blog")) || [];
            var i;

            listBlogs();

            // import {showDialog} from './blog.js';
            // import {closeDialog} from './blog.js';

            function addBlog() {
                let title = document.getElementsByTagName("input")[0].value;
                let date = document.getElementsByTagName("input")[1].value;
                let summary = document.getElementsByTagName("input")[2].value;
                blogs.push({
                    value: title,
                    date: date,
                    summary: summary
                });
                localStorage.setItem("blog", JSON.stringify(blogs));
                listBlogs();
                console.log(blogs);
            }

            function deleteBlog(index) {
                confirmDialog.showModal();
                i = index;
            }

            function editBlog(index) {
                editDialog.showModal();
                i = index;
                blog = blogs[i];
                document.getElementsByTagName("input")[3].value = blog.value;
                document.getElementsByTagName("input")[4].value = blog.date;
                document.getElementsByTagName("input")[5].value = blog.summary;
            }

            function listBlogs() {
                let blog = "";
                for (let i = 0; i < blogs.length; i++) {
                    blog += "<li>"
                    blog += `${blogs[i].value} ${blogs[i].date} ${blogs[i].summary} `;
                    blog += "<span onclick='editBlog(" + i + ")'><i class='fa fa-pencil'></i></span>";
                    blog += "<span onclick='deleteBlog(" + i + ")'><i class='fa fa-trash'></i></span></li>";
                }
                document.getElementById("blog").innerHTML = blog;
            }
            
            createButton.addEventListener("click", () => {
                createDialog.showModal();
            });
            cancelButton.addEventListener("click", () => {
                document.getElementsByTagName("input")[0].value = "";
                document.getElementsByTagName("input")[1].value = "";
                document.getElementsByTagName("input")[2].value = "";
                createDialog.close();
            });
            saveButton.addEventListener("click", () => {
                addBlog();
                document.getElementsByTagName("input")[0].value = "";
                document.getElementsByTagName("input")[1].value = "";
                document.getElementsByTagName("input")[2].value = "";
                createDialog.close();
            });

            confirmButton.addEventListener("click", () => {
                confirmDialog.close();
                blogs.splice(i, 1);
                localStorage.setItem("blog", JSON.stringify(blogs));
                listBlogs();
                console.log(blogs)
            })
            cancelButton2.addEventListener("click", () => {
                confirmDialog.close();
            })

            saveButton2.addEventListener("click", () => {
                blog = blogs[i];
                blog.value = document.getElementsByTagName("input")[3].value;
                blog.date = document.getElementsByTagName("input")[4].value;
                blog.summary = document.getElementsByTagName("input")[5].value;
                editDialog.close();
                localStorage.setItem("blog", JSON.stringify(blogs));
                listBlogs()
            })

            cancelButton3.addEventListener("click", () => {
                editDialog.close();
            })

        </script>
    </body>
</html>